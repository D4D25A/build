"use strict";(()=>{var e={};e.id=6668,e.ids=[6668],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},27570:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>k,patchFetch:()=>y,requestAsyncStorage:()=>x,routeModule:()=>h,serverHooks:()=>b,staticGenerationAsyncStorage:()=>w});var r={};s.r(r),s.d(r,{GET:()=>m,PATCH:()=>g});var o=s(49303),i=s(88716),n=s(60670),a=s(87070),l=s(75571),c=s(95021),u=s(83493),p=s(7410);let d=p.z.record(p.z.string(),p.z.unknown());async function m(){try{let e=(await u._.systemSettings.findMany()).reduce((e,t)=>{try{e[t.key]=JSON.parse(t.value)}catch{e[t.key]=t.value}return e},{});return a.NextResponse.json({success:!0,settings:e})}catch(e){return console.error("Error fetching settings:",e),a.NextResponse.json({success:!1,message:"Error fetching settings",error:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function g(e){try{let t=await (0,l.getServerSession)(c.authOptions);if(!t?.user)return a.NextResponse.json({success:!1,message:"Unauthorized"},{status:401});let s=await e.json(),r=d.parse(s),o=Object.entries(r).map(([e,t])=>u._.systemSettings.upsert({where:{key:e},update:{value:JSON.stringify(t)},create:{key:e,value:JSON.stringify(t)}}));return await Promise.all(o),a.NextResponse.json({success:!0,message:"Settings updated successfully"})}catch(e){return console.error("Error updating settings:",e),a.NextResponse.json({success:!1,message:e instanceof p.z.ZodError?`Validation error: ${e.errors.map(e=>e.message).join(", ")}`:"Error updating settings",error:e instanceof Error?e.message:"Unknown error"},{status:500})}}let h=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/settings/route",pathname:"/api/settings",filename:"route",bundlePath:"app/api/settings/route"},resolvedPagePath:"/Users/kyleaditya/Documents/IDF coupon fulldetails/app/api/settings/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:x,staticGenerationAsyncStorage:w,serverHooks:b}=h,k="/api/settings/route";function y(){return(0,n.patchFetch)({serverHooks:b,staticGenerationAsyncStorage:w})}},95021:(e,t,s)=>{s.r(t),s.d(t,{GET:()=>d,POST:()=>d,authOptions:()=>p});var r=s(75571),o=s.n(r),i=s(53797),n=s(42023),a=s.n(n),l=s(83493);class c{constructor(e=6e4,t=5,s=9e5){this.store=new Map,this.windowSize=e,this.maxAttempts=t,this.blockDuration=s}checkRateLimit(e){let t=Date.now(),s=this.store.get(e);if(.1>Math.random()&&this.cleanup(t),!s)return this.store.set(e,{count:1,timestamp:t,blocked:!1}),{blocked:!1};if(s.blocked){if(s.blockExpires&&t>=s.blockExpires)return this.store.set(e,{count:1,timestamp:t,blocked:!1}),{blocked:!1};let r=Math.ceil((s.blockExpires-t)/1e3);return{blocked:!0,message:`Too many login attempts. Please try again in ${r} seconds.`}}return t-s.timestamp>this.windowSize?(this.store.set(e,{count:1,timestamp:t,blocked:!1}),{blocked:!1}):(s.count+=1,s.count>this.maxAttempts)?(s.blocked=!0,s.blockExpires=t+this.blockDuration,this.store.set(e,s),{blocked:!0,message:`Too many login attempts. Please try again in ${this.blockDuration/1e3} seconds.`}):(this.store.set(e,s),{blocked:!1})}cleanup(e){for(let[t,s]of this.store.entries())(s.blocked&&e>=(s.blockExpires||0)||!s.blocked&&e-s.timestamp>this.windowSize)&&this.store.delete(t)}}let u=new c,p={providers:[(0,i.Z)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"},remember:{label:"Remember me",type:"boolean"}},async authorize(e,t){if(!e?.email||!e?.password)throw Error("Please enter an email and password");let s=(t?.headers?.["x-forwarded-for"]||"").split(",")[0].trim()||"unknown",r=u.checkRateLimit(s);if(r.blocked)throw Error(r.message||"Too many login attempts");let o=await l._.user.findUnique({where:{email:e.email}});if(!o)throw Error("No user found");if(!await a().compare(e.password,o.password))throw Error("Invalid password");return{id:o.id,email:o.email,name:o.name,role:o.role}}})],callbacks:{jwt:async({token:e,user:t})=>(t&&(e.role=t.role,e.id=t.id),e),session:async({session:e,token:t})=>(e?.user&&(e.user.role=t.role,e.user.id=t.id),e)},pages:{signIn:"/admin"},session:{strategy:"jwt",maxAge:2592e3},secret:process.env.NEXTAUTH_SECRET},d=o()(p)},83493:(e,t,s)=>{s.d(t,{_:()=>o});let r=require("@prisma/client"),o=globalThis.prisma??new r.PrismaClient}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[9276,5972,7313,7410],()=>s(27570));module.exports=r})();