"use strict";(()=>{var e={};e.id=3045,e.ids=[3045],e.modules={98860:e=>{e.exports=require("jsdom")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},86624:e=>{e.exports=require("querystring")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},29219:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>x,requestAsyncStorage:()=>h,routeModule:()=>f,serverHooks:()=>g,staticGenerationAsyncStorage:()=>w});var n={};r.r(n),r.d(n,{GET:()=>d,POST:()=>m});var i=r(49303),s=r(88716),a=r(60670),o=r(87070),l=r(75571),u=r(95021),p=r(83493),c=r(97453);async function d(){let e=await (0,l.getServerSession)(u.authOptions);if(!e?.user)return new o.NextResponse("Unauthorized",{status:401});let t=await p._.whitelistedUser.findMany({include:{addedBy:{select:{name:!0,email:!0}}},orderBy:{createdAt:"desc"}});return o.NextResponse.json(t)}async function m(e){let t=await (0,l.getServerSession)(u.authOptions);if(!t?.user)return new o.NextResponse("Unauthorized",{status:401});try{let r=await e.json(),n=c.oc(r.username)?.toLowerCase(),i=(0,c.yf)(r.platform);if(!n||!i)return new o.NextResponse("Missing or invalid required fields",{status:400});if(await p._.whitelistedUser.findFirst({where:{username:n,platform:i.charAt(0).toUpperCase()+i.slice(1)}}))return new o.NextResponse("Username already whitelisted for this platform",{status:400});let s=await p._.whitelistedUser.create({data:{username:n,platform:i.charAt(0).toUpperCase()+i.slice(1),addedBy:{connect:{email:t.user.email}}}});return o.NextResponse.json(s)}catch(e){return console.error("Error creating whitelisted user:",e),new o.NextResponse("Internal Server Error",{status:500})}}let f=new i.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/whitelist/route",pathname:"/api/whitelist",filename:"route",bundlePath:"app/api/whitelist/route"},resolvedPagePath:"/Users/kyleaditya/Documents/IDF coupon fulldetails/app/api/whitelist/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:h,staticGenerationAsyncStorage:w,serverHooks:g}=f,y="/api/whitelist/route";function x(){return(0,a.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:w})}},95021:(e,t,r)=>{r.r(t),r.d(t,{GET:()=>d,POST:()=>d,authOptions:()=>c});var n=r(75571),i=r.n(n),s=r(53797),a=r(42023),o=r.n(a),l=r(83493);class u{constructor(e=6e4,t=5,r=9e5){this.store=new Map,this.windowSize=e,this.maxAttempts=t,this.blockDuration=r}checkRateLimit(e){let t=Date.now(),r=this.store.get(e);if(.1>Math.random()&&this.cleanup(t),!r)return this.store.set(e,{count:1,timestamp:t,blocked:!1}),{blocked:!1};if(r.blocked){if(r.blockExpires&&t>=r.blockExpires)return this.store.set(e,{count:1,timestamp:t,blocked:!1}),{blocked:!1};let n=Math.ceil((r.blockExpires-t)/1e3);return{blocked:!0,message:`Too many login attempts. Please try again in ${n} seconds.`}}return t-r.timestamp>this.windowSize?(this.store.set(e,{count:1,timestamp:t,blocked:!1}),{blocked:!1}):(r.count+=1,r.count>this.maxAttempts)?(r.blocked=!0,r.blockExpires=t+this.blockDuration,this.store.set(e,r),{blocked:!0,message:`Too many login attempts. Please try again in ${this.blockDuration/1e3} seconds.`}):(this.store.set(e,r),{blocked:!1})}cleanup(e){for(let[t,r]of this.store.entries())(r.blocked&&e>=(r.blockExpires||0)||!r.blocked&&e-r.timestamp>this.windowSize)&&this.store.delete(t)}}let p=new u,c={providers:[(0,s.Z)({name:"Credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"},remember:{label:"Remember me",type:"boolean"}},async authorize(e,t){if(!e?.email||!e?.password)throw Error("Please enter an email and password");let r=(t?.headers?.["x-forwarded-for"]||"").split(",")[0].trim()||"unknown",n=p.checkRateLimit(r);if(n.blocked)throw Error(n.message||"Too many login attempts");let i=await l._.user.findUnique({where:{email:e.email}});if(!i)throw Error("No user found");if(!await o().compare(e.password,i.password))throw Error("Invalid password");return{id:i.id,email:i.email,name:i.name,role:i.role}}})],callbacks:{jwt:async({token:e,user:t})=>(t&&(e.role=t.role,e.id=t.id),e),session:async({session:e,token:t})=>(e?.user&&(e.user.role=t.role,e.user.id=t.id),e)},pages:{signIn:"/admin"},session:{strategy:"jwt",maxAge:2592e3},secret:process.env.NEXTAUTH_SECRET},d=i()(c)},83493:(e,t,r)=>{r.d(t,{_:()=>i});let n=require("@prisma/client"),i=globalThis.prisma??new n.PrismaClient},97453:(e,t,r)=>{r.d(t,{Cd:()=>c,DA:()=>d,EY:()=>h,Gi:()=>w,H3:()=>l,Rz:()=>N,Uw:()=>E,Vx:()=>f,Wx:()=>b,Yn:()=>x,Z6:()=>k,dB:()=>y,e7:()=>m,eB:()=>g,oc:()=>u,vJ:()=>o,yf:()=>p});var n=r(96468),i=r.n(n),s=r(61555),a=r.n(s);function o(e){return"string"!=typeof e?"":a().escape(e.trim())}function l(e){return"string"!=typeof e?"":a().normalizeEmail(e.trim().toLowerCase())||""}function u(e){return"string"!=typeof e?"":a().escape(e.trim()).replace(/[^a-zA-Z0-9_.-]/g,"")}function p(e){if("string"!=typeof e)return null;let t=e.trim();return"snapchat"===t.toLowerCase()?"Snapchat":"telegram"===t.toLowerCase()?"Telegram":null}function c(e){if("number"==typeof e)return e>0?Math.round(100*e)/100:null;if("string"==typeof e){let t=parseFloat(e);return!isNaN(t)&&t>0?Math.round(100*t)/100:null}return null}function d(e){if(e instanceof Date)return e;if("string"==typeof e){let t=new Date(e);return isNaN(t.getTime())?null:t}return null}function m(e){if("boolean"==typeof e)return e;if("string"==typeof e){let t=e.toLowerCase();return"true"===t||"1"===t||"yes"===t}return"number"==typeof e&&1===e}function f(e){if("string"!=typeof e)return null;let t=e.trim();return/^c[a-z0-9]{24}$/.test(t)?t:null}function h(e){if("string"!=typeof e)return null;let t=e.trim();return["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"].includes(t)?t:null}function w(e){if("string"!=typeof e)return null;let t=e.trim().toUpperCase();return["RECEIVED","PROCESSING","IN_PRODUCTION","IN_TRANSIT","DELIVERED","CANCELLED"].includes(t)?t:null}function g(e){return"string"!=typeof e?null:e.trim()||null}function y(e){if("string"!=typeof e)return null;let t=e.trim();if(!t.startsWith("data:image/"))return null;let[r,n]=t.split(",");if(!r||!n)return null;try{return atob(n),t}catch{return null}}function x(e){if("string"!=typeof e)return null;let t=e.trim().toUpperCase();return["ADMIN","USER"].includes(t)?t:null}function b(e){if("string"!=typeof e)return null;let t=e.trim().toUpperCase();return["INFO","FAQ","PRIVACY"].includes(t)?t:null}function k(e){return"string"!=typeof e?"":i().sanitize(e.trim())}function N(e){if("string"!=typeof e)return null;let t=e.trim();return/^[4-6]'(?:10|11|[0-9])"$/.test(t)?t:null}function E(e){if("number"==typeof e)return e>=50&&e<=500?Math.round(e):null;if("string"==typeof e){let t=parseInt(e,10);return!isNaN(t)&&t>=50&&t<=500?t:null}return null}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[9276,5972,7313,3556],()=>r(29219));module.exports=n})();